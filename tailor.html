<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Tailor Mode - Place Your Order</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f7f0fb 0%, #e8d5f2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    .header {
      text-align: center;
      margin-bottom: 30px;
    }

    h1 {
      color: #6a0dad;
      font-size: 2.5rem;
      margin-bottom: 10px;
      text-shadow: 1px 1px 2px rgba(0,0,0,0.1);
    }

    .subtitle {
      color: #666;
      font-size: 1.1rem;
      margin-bottom: 30px;
    }

    /* Step Progress Bar */
    .progress-container {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 15px;
      margin-bottom: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(106, 13, 173, 0.1);
    }

    .progress-steps {
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: relative;
      margin-bottom: 10px;
    }

    .progress-line {
      position: absolute;
      top: 20px;
      left: 0;
      right: 0;
      height: 3px;
      background: #e0e0e0;
      z-index: 1;
    }

    .progress-line-active {
      height: 3px;
      background: #6a0dad;
      transition: width 0.5s ease;
      z-index: 2;
    }

    .step {
      background: #e0e0e0;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: #666;
      z-index: 3;
      position: relative;
      transition: all 0.3s ease;
    }

    .step.active {
      background: #6a0dad;
      color: white;
    }

    .step.completed {
      background: #27ae60;
      color: white;
    }

    .step-labels {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }

    .step-label {
      text-align: center;
      font-size: 12px;
      color: #666;
      font-weight: 600;
    }

    .step-label.active {
      color: #6a0dad;
    }

    /* Main Content Area */
    .main-content {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 30px;
      backdrop-filter: blur(10px);
      box-shadow: 0 8px 32px rgba(106, 13, 173, 0.1);
      min-height: 600px;
    }

    /* Step 1: Tailor Selection */
    .tailor-selection {
      text-align: center;
    }

    .select-tailor-btn {
      background: linear-gradient(135deg, #6a0dad 0%, #8a4bb8 100%);
      color: white;
      padding: 20px 40px;
      border: none;
      border-radius: 15px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(106, 13, 173, 0.3);
      margin: 20px 0;
    }

    .select-tailor-btn:hover {
      background: linear-gradient(135deg, #5a2478 0%, #7a3fa5 100%);
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(106, 13, 173, 0.4);
    }

    .select-tailor-btn.selected {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    }

    .selected-tailor {
      background: rgba(106, 13, 173, 0.1);
      border: 2px solid #6a0dad;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .selected-tailor img {
      width: 80px;
      height: 80px;
      border-radius: 10px;
      object-fit: cover;
    }

    .selected-tailor-info h3 {
      color: #6a0dad;
      margin: 0 0 5px 0;
    }

    .selected-tailor-info p {
      margin: 0;
      color: #666;
    }

    .change-tailor-btn {
      background: #e74c3c;
      color: white;
      padding: 8px 16px;
      border: none;
      border-radius: 20px;
      cursor: pointer;
      font-size: 12px;
      margin-left: auto;
    }

    /* Tailor List Modal */
    .tailor-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      z-index: 1000;
      backdrop-filter: blur(5px);
    }

    .tailor-modal-content {
      background: white;
      margin: 2% auto;
      padding: 20px;
      border-radius: 20px;
      width: 90%;
      max-width: 1000px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
    }

    .modal-close {
      position: absolute;
      top: 15px;
      right: 20px;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      color: #6a0dad;
    }

    .tailor-list {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .tailor-card {
      background: #fff;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 4px 12px rgba(106, 13, 173, 0.1);
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
      border: 2px solid transparent;
    }

    .tailor-card:hover {
      transform: translateY(-5px);
      border-color: #6a0dad;
    }

    .tailor-card img {
      width: 100%;
      height: 150px;
      object-fit: cover;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .tailor-name {
      font-size: 16px;
      font-weight: bold;
      color: #6a0dad;
      margin-bottom: 5px;
    }

    .tailor-location {
      color: #555;
      font-size: 14px;
      margin-bottom: 5px;
    }

    .tailor-rating {
      color: #f39c12;
      font-weight: bold;
      font-size: 14px;
    }

    .tailor-distance {
      color: #6a0dad;
      font-size: 12px;
      margin: 5px 0;
    }

    /* Form Sections */
    .form-section {
      margin-bottom: 30px;
    }

    .form-section h3 {
      color: #6a0dad;
      margin-bottom: 15px;
      font-size: 1.3rem;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
    }

    .form-group select, .form-group input, .form-group textarea {
      width: 100%;
      padding: 12px 15px;
      border: 2px solid rgba(106, 13, 173, 0.2);
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      box-sizing: border-box;
    }

    .form-group select:focus, .form-group input:focus, .form-group textarea:focus {
      outline: none;
      border-color: #6a0dad;
      box-shadow: 0 0 0 3px rgba(106, 13, 173, 0.1);
    }

    .garment-options {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
    }

    .garment-option {
      background: rgba(106, 13, 173, 0.05);
      border: 2px solid rgba(106, 13, 173, 0.2);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .garment-option:hover, .garment-option.selected {
      background: #6a0dad;
      color: white;
      border-color: #6a0dad;
    }

    .garment-option .icon {
      font-size: 2rem;
      margin-bottom: 10px;
    }

    /* File Upload */
    .file-upload {
      border: 2px dashed #6a0dad;
      border-radius: 15px;
      padding: 30px;
      text-align: center;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .file-upload:hover {
      background: rgba(106, 13, 173, 0.05);
    }

    .file-upload.dragover {
      background: rgba(106, 13, 173, 0.1);
      border-color: #8a4bb8;
    }

    .file-upload input {
      display: none;
    }

    .uploaded-files {
      margin-top: 15px;
    }

    .uploaded-file {
      background: rgba(106, 13, 173, 0.1);
      padding: 10px 15px;
      border-radius: 10px;
      margin: 5px 0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .remove-file {
      color: #e74c3c;
      cursor: pointer;
      font-weight: bold;
    }

    /* Measurements */
    .measurements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
    }

    /* Navigation Buttons */
    .nav-buttons {
      display: flex;
      justify-content: space-between;
      margin-top: 30px;
      padding-top: 20px;
      border-top: 1px solid #eee;
    }

    .nav-btn {
      padding: 12px 30px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .nav-btn.prev {
      background: #95a5a6;
      color: white;
    }

    .nav-btn.prev:hover {
      background: #7f8c8d;
    }

    .nav-btn.next {
      background: linear-gradient(135deg, #6a0dad 0%, #8a4bb8 100%);
      color: white;
    }

    .nav-btn.next:hover {
      background: linear-gradient(135deg, #5a2478 0%, #7a3fa5 100%);
    }

    .nav-btn:disabled {
      background: #bdc3c7;
      cursor: not-allowed;
    }

    /* Order Summary */
    .order-summary {
      background: rgba(106, 13, 173, 0.05);
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
    }

    .order-summary h3 {
      color: #6a0dad;
      margin-bottom: 15px;
    }

    .summary-item {
      display: flex;
      justify-content: space-between;
      margin: 10px 0;
      padding: 5px 0;
      border-bottom: 1px solid rgba(106, 13, 173, 0.1);
    }

    .place-order-btn {
      background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
      color: white;
      padding: 15px 40px;
      border: none;
      border-radius: 25px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
      margin-top: 20px;
      transition: all 0.3s ease;
    }

    .place-order-btn:hover {
      background: linear-gradient(135deg, #229954 0%, #27ae60 100%);
      transform: translateY(-2px);
    }

    /* Hidden sections */
    .step-content {
      display: none;
    }

    .step-content.active {
      display: block;
    }

    .alert {
      padding: 15px;
      margin: 20px 0;
      border-radius: 10px;
      font-weight: 600;
    }

    .alert-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .alert-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .container {
        padding: 10px;
      }
      
      .progress-steps {
        flex-wrap: wrap;
      }
      
      .main-content {
        padding: 20px;
      }
      
      .garment-options {
        grid-template-columns: repeat(2, 1fr);
      }
      
      .measurements-grid {
        grid-template-columns: 1fr;
      }
      
      .nav-buttons {
        flex-direction: column;
        gap: 10px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>🧵 Tailor Mode</h1>
      <p class="subtitle">Place your custom stitching order with ease</p>
    </div>

    <!-- Progress Bar -->
    <div class="progress-container">
      <div class="progress-steps">
        <div class="progress-line">
          <div class="progress-line-active" id="progressLine"></div>
        </div>
        <div class="step active" id="step1">1</div>
        <div class="step" id="step2">2</div>
        <div class="step" id="step3">3</div>
        <div class="step" id="step4">4</div>
        <div class="step" id="step5">5</div>
      </div>
      <div class="step-labels">
        <div class="step-label active">Select Tailor</div>
        <div class="step-label">Choose Garment</div>
        <div class="step-label">Upload Measurements</div>
        <div class="step-label">Design Reference</div>
        <div class="step-label">Place Order</div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Step 1: Tailor Selection -->
      <div id="stepContent1" class="step-content active">
        <div class="tailor-selection">
          <h2>👤 Select Your Tailor</h2>
          <p>Choose from our network of skilled tailors near you</p>
          
          <div id="selectedTailorDiv" style="display: none;">
            <div class="selected-tailor" id="selectedTailor">
              <!-- Selected tailor info will be inserted here -->
            </div>
          </div>
          
          <button class="select-tailor-btn" onclick="openTailorModal()" id="selectTailorBtn">
            🔍 Browse & Select Tailor
          </button>
        </div>
      </div>

      <!-- Step 2: Garment Selection -->
      <div id="stepContent2" class="step-content">
        <div class="form-section">
          <h2>👗 Choose Your Garment</h2>
          <p>Select the type of garment you want to stitch</p>
          
          <div class="garment-options">
            <div class="garment-option" onclick="selectGarment('kurti', this)">
              <div class="icon">👚</div>
              <h4>Kurti</h4>
            </div>
            <div class="garment-option" onclick="selectGarment('shirt', this)">
              <div class="icon">👔</div>
              <h4>Shirt</h4>
            </div>
            <div class="garment-option" onclick="selectGarment('blouse', this)">
              <div class="icon">👘</div>
              <h4>Blouse</h4>
            </div>
            <div class="garment-option" onclick="selectGarment('dress', this)">
              <div class="icon">👗</div>
              <h4>Dress</h4>
            </div>
            <div class="garment-option" onclick="selectGarment('pant', this)">
              <div class="icon">👖</div>
              <h4>Pant</h4>
            </div>
            <div class="garment-option" onclick="selectGarment('skirt', this)">
              <div class="icon">🩱</div>
              <h4>Skirt</h4>
            </div>
          </div>

          <div class="form-group" style="margin-top: 30px;">
            <label for="garmentDetails">Special Requirements (Optional)</label>
            <textarea id="garmentDetails" rows="4" placeholder="Any specific details about the garment style, fit, or requirements..."></textarea>
          </div>
        </div>
      </div>

      <!-- Step 3: Measurements -->
      <div id="stepContent3" class="step-content">
        <div class="form-section">
          <h2>📏 Upload Your Measurements</h2>
          <p>Provide accurate measurements for the perfect fit</p>
          
          <div class="measurements-grid">
            <div class="form-group">
              <label for="height">Height (cm) *</label>
              <input type="number" id="height" placeholder="e.g., 165" required>
            </div>
            <div class="form-group">
              <label for="chest">Chest/Bust (cm) *</label>
              <input type="number" id="chest" placeholder="e.g., 36" required>
            </div>
            <div class="form-group">
              <label for="waist">Waist (cm) *</label>
              <input type="number" id="waist" placeholder="e.g., 30" required>
            </div>
            <div class="form-group">
              <label for="hip">Hip (cm) *</label>
              <input type="number" id="hip" placeholder="e.g., 38" required>
            </div>
            <div class="form-group">
              <label for="shoulder">Shoulder (cm) *</label>
              <input type="number" id="shoulder" placeholder="e.g., 15" required>
            </div>
            <div class="form-group">
              <label for="armLength">Arm Length (cm)</label>
              <input type="number" id="armLength" placeholder="e.g., 60">
            </div>
          </div>

          <div class="form-group">
            <label>Upload Measurement File (Optional)</label>
            <div class="file-upload" onclick="document.getElementById('measurementFile').click()">
              <input type="file" id="measurementFile" accept=".pdf,.doc,.docx,.jpg,.png" onchange="handleMeasurementUpload(event)">
              <p>📄 Click to upload measurement file or drag & drop</p>
              <small>Supported formats: PDF, DOC, DOCX, JPG, PNG</small>
            </div>
            <div id="measurementFiles" class="uploaded-files"></div>
          </div>
        </div>
      </div>

      <!-- Step 4: Design Reference -->
      <div id="stepContent4" class="step-content">
        <div class="form-section">
          <h2>🎨 Design Reference (Optional)</h2>
          <p>Upload images or documents showing your desired design</p>
          
          <div class="form-group">
            <label>Upload Design Images</label>
            <div class="file-upload" onclick="document.getElementById('designFiles').click()">
              <input type="file" id="designFiles" accept="image/*" multiple onchange="handleDesignUpload(event)">
              <p>🖼️ Click to upload design images or drag & drop</p>
              <small>You can upload multiple images (JPG, PNG, GIF)</small>
            </div>
            <div id="designFilesList" class="uploaded-files"></div>
          </div>

          <div class="form-group">
            <label for="designNotes">Design Notes</label>
            <textarea id="designNotes" rows="4" placeholder="Describe your design preferences, colors, patterns, style details..."></textarea>
          </div>

          <div class="form-group">
            <label for="deadline">Preferred Completion Date</label>
            <input type="date" id="deadline" min="">
          </div>
        </div>
      </div>

      <!-- Step 5: Order Summary & Place Order -->
      <div id="stepContent5" class="step-content">
        <div class="form-section">
          <h2>📋 Order Summary</h2>
          <p>Review your order details before placing the request</p>
          
          <div class="order-summary">
            <h3>Order Details</h3>
            <div class="summary-item">
              <span><strong>Selected Tailor:</strong></span>
              <span id="summaryTailor">-</span>
            </div>
            <div class="summary-item">
              <span><strong>Garment Type:</strong></span>
              <span id="summaryGarment">-</span>
            </div>
            <div class="summary-item">
              <span><strong>Measurements:</strong></span>
              <span id="summaryMeasurements">Provided</span>
            </div>
            <div class="summary-item">
              <span><strong>Design Reference:</strong></span>
              <span id="summaryDesign">-</span>
            </div>
            <div class="summary-item">
              <span><strong>Deadline:</strong></span>
              <span id="summaryDeadline">-</span>
            </div>
          </div>

          <div class="form-group">
            <label for="customerNotes">Additional Notes for Tailor</label>
            <textarea id="customerNotes" rows="3" placeholder="Any special instructions or requests..."></textarea>
          </div>

          <button class="place-order-btn" onclick="placeOrder()">
            🎯 Place Stitching Order
          </button>
        </div>
      </div>

      <!-- Navigation Buttons -->
      <div class="nav-buttons">
        <button class="nav-btn prev" onclick="previousStep()" id="prevBtn" style="display: none;">
          ← Previous
        </button>
        <button class="nav-btn next" onclick="nextStep()" id="nextBtn" disabled>
          Next →
        </button>
      </div>
    </div>
  </div>

  <!-- Tailor Selection Modal -->
  <div id="tailorModal" class="tailor-modal">
    <div class="tailor-modal-content">
      <span class="modal-close" onclick="closeTailorModal()">&times;</span>
      <h2>Select Your Tailor</h2>
      
      <!-- Location Controls -->
      <div style="margin-bottom: 20px;">
        <div style="display: flex; gap: 10px; margin-bottom: 15px;">
          <input type="text" id="modalSearchInput" placeholder="Search by location or tailor name..." 
                 style="flex: 1; padding: 10px; border: 2px solid #ddd; border-radius: 10px;">
          <button onclick="getLocationInModal()" style="padding: 10px 20px; background: #6a0dad; color: white; border: none; border-radius: 10px;">
            📍 Use My Location
          </button>
        </div>
        <div id="modalLocationStatus" style="text-align: center; padding: 10px; background: #f8f9fa; border-radius: 10px; color: #666;">
          📍 Enable location to find nearby tailors
        </div>
      </div>
      
      <div id="modalTailorList" class="tailor-list">
        <!-- Tailors will be populated here -->
      </div>
    </div>
  </div>

  <script>
    // Tailor data
    const tailors = [
      {
        id: 1,
        name: "Stitch & Style",
        location: "R.S. Puram, Coimbatore",
        rating: 4.0,
        coordinates: { lat: 11.0168, lng: 76.9558 },
        phone: "+91 9876543210",
        image: "https://via.placeholder.com/300x200?text=Stitch+%26+Style&bg=6a0dad&color=white"
      },
      {
        id: 2,
        name: "Perfect Fit Tailors",
        location: "Gandhipuram, Coimbatore",
        rating: 4.8,
        coordinates: { lat: 11.0183, lng: 76.9725 },
        phone: "+91 9876543211",
        image: "https://via.placeholder.com/300x200?text=Perfect+Fit+Tailors&bg=27ae60&color=white"
      },
      {
        id: 3,
        name: "Classic Cuts",
        location: "Race Course, Coimbatore",
        rating: 4.2,
        coordinates: { lat: 11.0041, lng: 76.9597 },
        phone: "+91 9876543212",
        image: "https://via.placeholder.com/300x200?text=Classic+Cuts&bg=e74c3c&color=white"
      },
      {
        id: 4,
        name: "Smart Stitch",
        location: "Saibaba Colony, Coimbatore",
        rating: 3.9,
        coordinates: { lat: 11.0510, lng: 76.9638 },
        phone: "+91 9876543213",
        image: "https://via.placeholder.com/300x200?text=Smart+Stitch&bg=f39c12&color=white"
      },
      {
        id: 5,
        name: "Thread & Needle",
        location: "Vadavalli, Coimbatore",
        rating: 5.0,
        coordinates: { lat: 11.0214, lng: 76.9045 },
        phone: "+91 9876543214",
        image: "https://via.placeholder.com/300x200?text=Thread+%26+Needle&bg=9b59b6&color=white"
      },
      {
        id: 6,
        name: "Elegant Tailors",
        location: "Kuniyamuthur, Coimbatore",
        rating: 4.3,
        coordinates: { lat: 10.9924, lng: 76.9510 },
        phone: "+91 9876543215",
        image: "https://via.placeholder.com/300x200?text=Elegant+Tailors&bg=2c3e50&color=white"
      },
      {
        id: 7,
        name: "The Fashion Stitch",
        location: "Singanallur, Coimbatore",
        rating: 3.7,
        coordinates: { lat: 11.0257, lng: 77.0344 },
        phone: "+91 9876543216",
        image: "https://via.placeholder.com/300x200?text=The+Fashion+Stitch&bg=34495e&color=white"
      },
      {
        id: 8,
        name: "Urban Threads",
        location: "Ganapathy, Coimbatore",
        rating: 4.1,
        coordinates: { lat: 11.0618, lng: 76.9902 },
        phone: "+91 9876543217",
        image: "https://via.placeholder.com/300x200?text=Urban+Threads&bg=16a085&color=white"
      },
      {
        id: 9,
        name: "Style Hub",
        location: "Thudiyalur, Coimbatore",
        rating: 3.5,
        coordinates: { lat: 11.0770, lng: 76.8},
          image: "https://via.placeholder.com/300x200?text=Style+Hub&bg=8e44ad&color=white"
      },
      {
        id: 10,
        name: "Chic Tailoring",
        location: "Podanur, Coimbatore",
        rating: 4.9,
        coordinates: { lat: 10.9986, lng: 76.9719 },
        phone: "+91 9876543219",
        image: "https://via.placeholder.com/300x200?text=Chic+Tailoring&bg=d35400&color=white"
      }
    ];

    // Global variables
    let currentStep = 1;
    let selectedTailor = null;
    let selectedGarment = null;
    let userLocation = null;
    let measurementFiles = [];
    let designFiles = [];

    // Step navigation
    function nextStep() {
      if (validateCurrentStep()) {
        if (currentStep < 5) {
          currentStep++;
          updateStepDisplay();
          
          // Update order summary when reaching step 5
          if (currentStep === 5) {
            updateOrderSummary();
          }
        }
      } else {
        showValidationError();
      }
    }

    function previousStep() {
      if (currentStep > 1) {
        currentStep--;
        updateStepDisplay();
      }
    }

    function updateStepDisplay() {
      // Hide all step contents
      document.querySelectorAll('.step-content').forEach(content => {
        content.classList.remove('active');
      });

      // Show current step content
      document.getElementById(`stepContent${currentStep}`).classList.add('active');

      // Update progress bar
      document.querySelectorAll('.step').forEach((step, index) => {
        step.classList.remove('active', 'completed');
        if (index + 1 < currentStep) {
          step.classList.add('completed');
        } else if (index + 1 === currentStep) {
          step.classList.add('active');
        }
      });

      // Update step labels
      document.querySelectorAll('.step-label').forEach((label, index) => {
        label.classList.remove('active');
        if (index + 1 === currentStep) {
          label.classList.add('active');
        }
      });

      // Update progress line
      const progressLine = document.getElementById('progressLine');
      const progressWidth = ((currentStep - 1) / 4) * 100;
      progressLine.style.width = progressWidth + '%';

      // Update navigation buttons
      const prevBtn = document.getElementById('prevBtn');
      const nextBtn = document.getElementById('nextBtn');

      if (currentStep === 1) {
        prevBtn.style.display = 'none';
      } else {
        prevBtn.style.display = 'inline-block';
      }

      if (currentStep === 5) {
        nextBtn.style.display = 'none';
      } else {
        nextBtn.style.display = 'inline-block';
        nextBtn.disabled = !validateCurrentStep();
      }
    }

    function validateCurrentStep() {
      switch (currentStep) {
        case 1:
          return selectedTailor !== null;
        case 2:
          return selectedGarment !== null;
        case 3:
          const requiredFields = ['height', 'chest', 'waist', 'hip', 'shoulder'];
          return requiredFields.every(field => {
            const value = document.getElementById(field).value;
            return value && value.trim() !== '';
          });
        case 4:
          return true; // Optional step
        case 5:
          return true;
        default:
          return false;
      }
    }

    function showValidationError() {
      let message = '';
      switch (currentStep) {
        case 1:
          message = 'Please select a tailor before proceeding.';
          break;
        case 2:
          message = 'Please select a garment type before proceeding.';
          break;
        case 3:
          message = 'Please fill in all required measurements (Height, Chest, Waist, Hip, Shoulder).';
          break;
      }
      
      // Create and show alert
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert alert-error';
      alertDiv.textContent = message;
      
      const mainContent = document.querySelector('.main-content');
      mainContent.insertBefore(alertDiv, mainContent.firstChild);
      
      // Remove alert after 5 seconds
      setTimeout(() => {
        alertDiv.remove();
      }, 5000);
    }

    // Tailor selection functions
    function openTailorModal() {
      document.getElementById('tailorModal').style.display = 'block';
      displayTailorsInModal();
    }

    function closeTailorModal() {
      document.getElementById('tailorModal').style.display = 'none';
    }

    function displayTailorsInModal() {
      const modalTailorList = document.getElementById('modalTailorList');
      modalTailorList.innerHTML = tailors.map(tailor => {
        const distanceHTML = tailor.distance ? 
          `<div class="tailor-distance">📍 ${tailor.distance.toFixed(1)} km away</div>` : '';
        
        return `
          <div class="tailor-card" onclick="selectTailorFromModal(${tailor.id})">
            <img src="${tailor.image}" alt="${tailor.name}">
            <div class="tailor-name">${tailor.name}</div>
            <div class="tailor-location">📍 ${tailor.location}</div>
            ${distanceHTML}
            <div class="tailor-rating">${generateStars(tailor.rating)} (${tailor.rating})</div>
          </div>
        `;
      }).join('');
    }

    function selectTailorFromModal(tailorId) {
      selectedTailor = tailors.find(t => t.id === tailorId);
      
      // Update selected tailor display
      const selectedTailorDiv = document.getElementById('selectedTailorDiv');
      const selectedTailorElement = document.getElementById('selectedTailor');
      const selectTailorBtn = document.getElementById('selectTailorBtn');
      
      selectedTailorElement.innerHTML = `
        <img src="${selectedTailor.image}" alt="${selectedTailor.name}">
        <div class="selected-tailor-info">
          <h3>${selectedTailor.name}</h3>
          <p>📍 ${selectedTailor.location}</p>
          <p>${generateStars(selectedTailor.rating)} (${selectedTailor.rating})</p>
          <p>📞 ${selectedTailor.phone}</p>
        </div>
        <button class="change-tailor-btn" onclick="openTailorModal()">Change</button>
      `;
      
      selectedTailorDiv.style.display = 'block';
      selectTailorBtn.textContent = '✓ Tailor Selected - Click to Change';
      selectTailorBtn.classList.add('selected');
      
      // Close modal
      closeTailorModal();
      
      // Update next button state
      document.getElementById('nextBtn').disabled = false;
    }

    // Garment selection
    function selectGarment(garmentType, element) {
      selectedGarment = garmentType;
      
      // Remove previous selections
      document.querySelectorAll('.garment-option').forEach(option => {
        option.classList.remove('selected');
      });
      
      // Add selection to clicked option
      element.classList.add('selected');
      
      // Update next button state
      document.getElementById('nextBtn').disabled = false;
    }

    // File upload handlers
    function handleMeasurementUpload(event) {
      const files = Array.from(event.target.files);
      measurementFiles = [...measurementFiles, ...files];
      displayUploadedFiles('measurementFiles', measurementFiles, 'measurement');
    }

    function handleDesignUpload(event) {
      const files = Array.from(event.target.files);
      designFiles = [...designFiles, ...files];
      displayUploadedFiles('designFilesList', designFiles, 'design');
    }

    function displayUploadedFiles(containerId, fileList, type) {
      const container = document.getElementById(containerId);
      container.innerHTML = fileList.map((file, index) => `
        <div class="uploaded-file">
          <span>📎 ${file.name} (${(file.size / 1024).toFixed(1)} KB)</span>
          <span class="remove-file" onclick="removeFile('${type}', ${index})">✕</span>
        </div>
      `).join('');
    }

    function removeFile(type, index) {
      if (type === 'measurement') {
        measurementFiles.splice(index, 1);
        displayUploadedFiles('measurementFiles', measurementFiles, 'measurement');
      } else if (type === 'design') {
        designFiles.splice(index, 1);
        displayUploadedFiles('designFilesList', designFiles, 'design');
      }
    }

    // Location functions
    function calculateDistance(lat1, lon1, lat2, lon2) {
      const R = 6371; // Radius of the Earth in kilometers
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = 
        Math.sin(dLat/2) * Math.sin(dLat/2) +
        Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * 
        Math.sin(dLon/2) * Math.sin(dLon/2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
      return R * c;
    }

    function getLocationInModal() {
      const statusDiv = document.getElementById('modalLocationStatus');
      statusDiv.innerHTML = '📍 Getting your location...';
      statusDiv.style.background = '#ffeaa7';
      
      if (!navigator.geolocation) {
        statusDiv.innerHTML = '❌ Geolocation not supported by your browser';
        statusDiv.style.background = '#fdcb6e';
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (position) => {
          userLocation = {
            lat: position.coords.latitude,
            lng: position.coords.longitude
          };
          
          statusDiv.innerHTML = '✅ Location found! Showing nearby tailors';
          statusDiv.style.background = '#d1f2eb';
          
          // Calculate distances for all tailors
          tailors.forEach(tailor => {
            tailor.distance = calculateDistance(
              userLocation.lat, 
              userLocation.lng, 
              tailor.coordinates.lat, 
              tailor.coordinates.lng
            );
          });
          
          // Sort tailors by distance
          tailors.sort((a, b) => a.distance - b.distance);
          
          // Refresh the tailor display
          displayTailorsInModal();
        },
        (error) => {
          let errorMessage = '❌ Unable to get location: ';
          switch(error.code) {
            case error.PERMISSION_DENIED:
              errorMessage += 'Permission denied';
              break;
            case error.POSITION_UNAVAILABLE:
              errorMessage += 'Position unavailable';
              break;
            case error.TIMEOUT:
              errorMessage += 'Request timeout';
              break;
            default:
              errorMessage += 'Unknown error';
              break;
          }
          statusDiv.innerHTML = errorMessage;
          statusDiv.style.background = '#fadbd8';
        },
        {
          enableHighAccuracy: true,
          timeout: 10000,
          maximumAge: 300000 // 5 minutes
        }
      );
    }

    function generateStars(rating) {
      const fullStars = Math.floor(rating);
      const hasHalfStar = rating % 1 !== 0;
      let stars = '';
      
      for (let i = 0; i < fullStars; i++) {
        stars += '⭐';
      }
      
      if (hasHalfStar) {
        stars += '⭐';
      }
      
      const emptyStars = 5 - Math.ceil(rating);
      for (let i = 0; i < emptyStars; i++) {
        stars += '☆';
      }
      
      return stars;
    }

    // Modal search functionality
    function searchTailorsInModal() {
      const searchTerm = document.getElementById('modalSearchInput').value.toLowerCase();
      const filteredTailors = searchTerm === '' ? tailors : 
        tailors.filter(tailor => 
          tailor.name.toLowerCase().includes(searchTerm) ||
          tailor.location.toLowerCase().includes(searchTerm)
        );
      
      const modalTailorList = document.getElementById('modalTailorList');
      modalTailorList.innerHTML = filteredTailors.map(tailor => {
        const distanceHTML = tailor.distance ? 
          `<div class="tailor-distance">📍 ${tailor.distance.toFixed(1)} km away</div>` : '';
        
        return `
          <div class="tailor-card" onclick="selectTailorFromModal(${tailor.id})">
            <img src="${tailor.image}" alt="${tailor.name}">
            <div class="tailor-name">${tailor.name}</div>
            <div class="tailor-location">📍 ${tailor.location}</div>
            ${distanceHTML}
            <div class="tailor-rating">${generateStars(tailor.rating)} (${tailor.rating})</div>
          </div>
        `;
      }).join('');
    }

    // Order summary and placement
    function updateOrderSummary() {
      document.getElementById('summaryTailor').textContent = selectedTailor ? selectedTailor.name : '-';
      document.getElementById('summaryGarment').textContent = selectedGarment ? 
        selectedGarment.charAt(0).toUpperCase() + selectedGarment.slice(1) : '-';
      
      // Check if measurements are provided
      const requiredFields = ['height', 'chest', 'waist', 'hip', 'shoulder'];
      const measurementsProvided = requiredFields.every(field => {
        const value = document.getElementById(field).value;
        return value && value.trim() !== '';
      });
      document.getElementById('summaryMeasurements').textContent = measurementsProvided ? 'Provided' : 'Missing';
      
      document.getElementById('summaryDesign').textContent = designFiles.length > 0 ? 
        `${designFiles.length} files uploaded` : 'None';
      
      const deadline = document.getElementById('deadline').value;
      document.getElementById('summaryDeadline').textContent = deadline || 'Not specified';
    }

    function placeOrder() {
      // Final validation
      if (!selectedTailor || !selectedGarment) {
        alert('❌ Please complete all required steps before placing the order.');
        return;
      }

      // Collect all order data
      const orderData = {
        tailor: selectedTailor,
        garment: selectedGarment,
        measurements: {
          height: document.getElementById('height').value,
          chest: document.getElementById('chest').value,
          waist: document.getElementById('waist').value,
          hip: document.getElementById('hip').value,
          shoulder: document.getElementById('shoulder').value,
          armLength: document.getElementById('armLength').value
        },
        garmentDetails: document.getElementById('garmentDetails').value,
        designNotes: document.getElementById('designNotes').value,
        deadline: document.getElementById('deadline').value,
        customerNotes: document.getElementById('customerNotes').value,
        measurementFiles: measurementFiles.map(file => file.name),
        designFiles: designFiles.map(file => file.name),
        orderDate: new Date().toISOString(),
        orderId: 'TO-' + Date.now() // Simple order ID generation
      };
      
      // Show success message
      const successMessage = `🎉 Order placed successfully!

Order ID: ${orderData.orderId}

Order Details:
- Tailor: ${selectedTailor.name}
- Location: ${selectedTailor.location}
- Garment: ${selectedGarment.charAt(0).toUpperCase() + selectedGarment.slice(1)}
- Contact: ${selectedTailor.phone}

Next Steps:
✅ You will receive a confirmation call from your selected tailor within 24 hours
✅ The tailor will discuss pricing and timeline with you directly
✅ Keep your Order ID for future reference

Thank you for using Tailor Mode!`;

      alert(successMessage);
      
      // Log order data for debugging (in real app, send to backend)
      console.log('Order Data:', orderData);
      
      // Show success alert in the UI
      const alertDiv = document.createElement('div');
      alertDiv.className = 'alert alert-success';
      alertDiv.innerHTML = `
        <strong>🎉 Order Placed Successfully!</strong><br>
        Order ID: ${orderData.orderId}<br>
        You will receive a confirmation call within 24 hours.
      `;
      
      const mainContent = document.querySelector('.main-content');
      mainContent.insertBefore(alertDiv, mainContent.firstChild);
      
      // Disable the place order button
      const placeOrderBtn = document.querySelector('.place-order-btn');
      placeOrderBtn.disabled = true;
      placeOrderBtn.textContent = '✅ Order Placed Successfully';
      placeOrderBtn.style.background = '#95a5a6';
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', function() {
      // Set minimum date for deadline to today
      const today = new Date().toISOString().split('T')[0];
      document.getElementById('deadline').min = today;
      
      // Add search functionality to modal
      document.getElementById('modalSearchInput').addEventListener('input', searchTailorsInModal);
      
      // Add drag and drop functionality
      setupDragAndDrop();
      
      // Initialize display
      updateStepDisplay();
    });

    // Setup drag and drop for file uploads
    function setupDragAndDrop() {
      const fileUploads = document.querySelectorAll('.file-upload');
      
      fileUploads.forEach(upload => {
        upload.addEventListener('dragover', (e) => {
          e.preventDefault();
          upload.classList.add('dragover');
        });
        
        upload.addEventListener('dragleave', (e) => {
          e.preventDefault();
          upload.classList.remove('dragover');
        });
        
        upload.addEventListener('drop', (e) => {
          e.preventDefault();
          upload.classList.remove('dragover');
          
          const files = e.dataTransfer.files;
          const input = upload.querySelector('input[type="file"]');
          
          if (input.id === 'measurementFile') {
            measurementFiles = [...measurementFiles, ...Array.from(files)];
            displayUploadedFiles('measurementFiles', measurementFiles, 'measurement');
          } else if (input.id === 'designFiles') {
            designFiles = [...designFiles, ...Array.from(files)];
            displayUploadedFiles('designFilesList', designFiles, 'design');
          }
        });
      });
    }

    // Close modal when clicking outside
    window.onclick = function(event) {
      const modal = document.getElementById('tailorModal');
      if (event.target === modal) {
        closeTailorModal();
      }
    }

    // Add input validation listeners
    document.addEventListener('DOMContentLoaded', function() {
      const measurementInputs = ['height', 'chest', 'waist', 'hip', 'shoulder', 'armLength'];
      
      measurementInputs.forEach(inputId => {
        const input = document.getElementById(inputId);
        if (input) {
          input.addEventListener('input', function() {
            // Remove any non-numeric characters except decimal point
            this.value = this.value.replace(/[^0-9.]/g, '');
            
            // Ensure only one decimal point
            const parts = this.value.split('.');
            if (parts.length > 2) {
              this.value = parts[0] + '.' + parts.slice(1).join('');
            }
            
            // Update next button state
            document.getElementById('nextBtn').disabled = !validateCurrentStep();
          });
        }
      });
    });
  </script>
</body>
</html>